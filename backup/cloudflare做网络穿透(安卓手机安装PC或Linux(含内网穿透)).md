<html>
<body>
<!--StartFragment--><html><head></head><body><div ksdocclipboard="ksDocClipboardId:'{86603348-d321-018e-93e9-cc3185758c7c-0}';from:'outline';priorityFormat:'';mimetypes:'text/html;text/plain';dataType:'';srcRange:'';ext:'e30='"><div finger="kso-wps-otl" source="387283028536"><h1 backgroundcolor="0" class="otl-heading" level="1" listlevel="0" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>第二章：cloudflare做网络穿透</span></h1><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #FAF1E6;border-color: #FEC794;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>下载cloudflare的安装包</span></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><code style="font-size:16px;"><span>curl -L </span></code><a class="hyperlink" href="https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64" hreftitle="https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64" sync2href="true" target="_Blank"><code style="font-size:16px;"><span>https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64</span></code></a><code style="font-size:16px;"><span> -o /usr/local/bin/cloudflared</span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>赋予执行权限</span></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><code style="font-size:16px;"><span>chmod +x /usr/local/bin/cloudflared</span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>确认是否安装成功</span></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><code style="font-size:16px;"><span>cloudflared version</span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>执行</span></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><code style="font-size:16px;"><span>cloudflared service install 你的密钥</span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">卸载命令</span></strong></span><span>：</span><code style="font-size:16px;"><span class="color_font" style="color:#C21C13;"><span style="color:#C21C13;">cloudflared service uninstall</span></span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span class="color_font" style="-webkit-background-clip:text;-webkit-box-decoration-break:clone;-webkit-text-fill-color:transparent;background-clip:text;background-image:linear-gradient(90deg,#0E52D4,#A639D7);box-decoration-break:clone;color:#0E52D4;font-size:18px;font-weight:bold;"><strong><span style="-webkit-background-clip:text;-webkit-box-decoration-break:clone;-webkit-text-fill-color:transparent;background-clip:text;background-image:linear-gradient(90deg,#0E52D4,#A639D7);box-decoration-break:clone;color:#0E52D4;font-size:18px;font-weight:bold;">Docker版看这里</span></strong></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span class="color_font" style="background-color:#FBF5B3;font-size:20px;font-weight:bold;mso-highlight:#FBF5B3;text-decoration:underline;"><strong><u><span style="background-color:#FBF5B3;font-size:20px;font-weight:bold;mso-highlight:#FBF5B3;text-decoration:underline;">参考这个链接</span></u></strong></span><span>：</span><a class="hyperlink" href="https://sspai.com/post/79278" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><strong><span style="font-weight:bold;">docker的附加参数：</span></strong></p></div><div class="sub-doc-tile" config="{}" info="{}"><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="0" listtype="bullet" listvalue="dot" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>--link alist:alist #容器间相互通信</span></li></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="0" listtype="bullet" listvalue="dot" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>--network host #容器内的应用就能直接访问宿主机的 localhost</span></li></ul></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><code style="font-size:18px;"><span style="font-size:18px;">docker run --link alist:alist cloudflare/cloudflared:latest tunnel --no-autoupdate run --token 你的token</span></code></p></div></div></div></div><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>已废弃部分</span></p><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #EBEBEB;border-color: #C5C5C5;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="9" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;background-color:#F2F2F2;
      border-radius: 3px;
      box-shadow: -2px 0 #F2F2F2, 2px 0 #F2F2F2;
      --current-bg-color: #F2F2F2;" textalign="left"><s><span style="text-decoration:line-through;">下载cloudflare的ubuntu文件</span></s></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><code style="font-size:16px;"><s><span style="text-decoration:line-through;">curl -L --output cloudflared.deb </span></s></code><a class="hyperlink" href="https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb" hreftitle="https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb" sync2href="true" target="_Blank"><code style="font-size:16px;"><s><span style="text-decoration:line-through;">https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb</span></s></code></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;text-decoration:line-through underline;"><s><u><span style="color:#C21C13;text-decoration:line-through underline;">注意：这里curl可能会碰到https无法下载的问题，建议把文件放到http（</span></u></s></span><span class="color_font" style="color:#C21C13;font-weight:bold;text-decoration:line-through underline;"><strong><s><u><span style="color:#C21C13;font-weight:bold;text-decoration:line-through underline;">AList</span></u></s></strong></span><span class="color_font" style="color:#C21C13;text-decoration:line-through underline;"><s><u><span style="color:#C21C13;text-decoration:line-through underline;">）下面</span></u></s></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><s><span style="text-decoration:line-through;">sudo dpkg -i cloudflared.deb </span></s></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;text-decoration:line-through underline;"><s><u><span style="color:#C21C13;text-decoration:line-through underline;">注意：这里可能会报错package architecture (amd64) does not match system (arm64)</span></u></s></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;text-decoration:line-through;"><s><span style="color:#C21C13;text-decoration:line-through;">解决：sudo dpkg -i --force-architecture cloudflared.deb （</span></s></span><a class="hyperlink" href="https://github.com/kubernetes/minikube/issues/10001" hreftitle="点击参考" sync2href="false" target="_Blank"><span class="color_font" style="color:#C21C13;text-decoration:line-through;"><s><span style="color:#C21C13;text-decoration:line-through;">点击参考</span></s></span></a><span class="color_font" style="color:#C21C13;text-decoration:line-through;"><s><span style="color:#C21C13;text-decoration:line-through;">）</span></s></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><s><span style="text-decoration:line-through;">sudo cloudflared service install 你的密钥</span></s></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;text-decoration:line-through;"><s><span style="color:#C21C13;text-decoration:line-through;">成功会显示：</span></s></span><code style="font-size:16px;"><span class="color_font" style="color:#C21C13;text-decoration:line-through;"><s><span style="color:#C21C13;text-decoration:line-through;">Illegal instruction</span></s></span></code></p></div></div></div></div><h2 backgroundcolor="0" class="otl-heading" level="2" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>网页版SSH内网穿透</span></h2><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #FAF1E6;border-color: #FEC794;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">将服务器连接到 Cloudflare：</span></strong></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">创建 Cloudflare Tunnel：</span></strong><span> 登录到 Cloudflare Zero Trust 仪表板，导航至“Networks” &gt; “Tunnels”，点击“Create a tunnel”。选择“Cloudflared”作为连接器类型，输入隧道名称，然后点击“Save tunnel”。</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">安装并运行 </span></strong><code style="font-size:16px;"><strong><span style="font-weight:bold;">cloudflared</span></strong></code><strong><span style="font-weight:bold;">：</span></strong><span> 根据您的服务器操作系统，下载并安装 </span><code style="font-size:16px;"><span>cloudflared</span></code><span>。在服务器上运行提供的命令以启动 </span><code style="font-size:16px;"><span>cloudflared</span></code><span>，这将建立服务器与 Cloudflare 之间的隧道连接。</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">配置公共主机名：</span></strong><span> 在隧道的“Public Hostnames”选项卡中，选择一个域名和子域名（例如 </span><a class="hyperlink" href="https://ssh.example.com/" hreftitle="ssh.example.com" sync2href="true" target="_Blank"><code style="font-size:16px;"><span>ssh.example.com</span></code></a><span>），将其指向您的 SSH 服务（通常是 </span><code style="font-size:16px;"><span>localhost:22</span></code><span>）。保存主机名设置。 </span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">配置 Cloudflare Access 应用程序：(</span></strong><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">下面的步骤一定要做！</span></strong></span><strong><span style="font-weight:bold;">)</span></strong></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">创建应用程序：</span></strong><span> 在 Cloudflare Zero Trust 仪表板中，转到“Access” &gt; “Applications”，点击“Add an application”，选择“Self-hosted”。</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">设置应用程序详细信息：</span></strong><span> 输入应用程序名称，设置“Application domain”为之前配置的公共主机名（例如 </span><a class="hyperlink" href="https://ssh.example.com/" sync2href="true" target="_Blank"><code style="font-size:16px;"><span>ssh.example.com</span></code></a><span>）。</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">配置访问策略：</span></strong><span> 在“Policies”选项卡中，添加相应的访问策略，指定允许访问该应用程序的用户或组。(</span><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">必须配置一个Everyone的mail策略，否则无法收到邮件)</span></strong></span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">启用浏览器渲染：</span></strong><span> 在“Advanced settings”下的“Browser rendering settings”中，将“Browser rendering”设置为“SSH”。保存应用程序设置。 </span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">用户访问 SSH 终端：</span></strong></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">访问公共主机名：</span></strong><span> 用户在浏览器中访问配置的公共主机名（例如 </span><a class="hyperlink" href="https://ssh.example.com/" sync2href="true" target="_Blank"><code style="font-size:16px;"><span>https://ssh.example.com</span></code></a><span>）。</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">身份验证：</span></strong><span> 用户将根据之前配置的访问策略进行身份验证。</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">Linux账户验证</span></strong><span>：输入alpine，密码alpine</span></li></ul></ul></div><div class="sub-doc-tile" config="{}" info="{}"><ul><ul><li backgroundcolor="0" class="otl-paragraph" listlevel="1" listtype="bullet" listvalue="circle" style="padding-left:2.8em;text-indent:-1.4em;text-align:left;" textalign="left"><strong><span style="font-weight:bold;">使用浏览器终端：</span></strong><span> 成功验证后，Cloudflare 将在浏览器中呈现一个 SSH 终端，用户可以直接在其中操作服务器，无需在客户端安装任何额外的软件或管理 SSH 密钥。 </span></li></ul></ul></div></div></div></div><h2 backgroundcolor="0" class="otl-heading" level="2" listlevel="0" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>CF节点优选</span></h2><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #FAF1E6;border-color: #FEC794;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>CloudFlare公共优选Cname域名地址1：</span><a class="hyperlink" href="https://www.wetest.vip/" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span>CloudFlare公共优选Cname域名地址2：</span><a class="hyperlink" href="https://www.wetest.vip/" hreftitle="点我" sync2href="false" target="_Blank"><span>点</span></a><a class="hyperlink" href="https://blog.nbvil.com/nat/saasip/" hreftitle="我" sync2href="false" target="_Blank"><span>我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span>CloudFlare优质IP：</span><a class="hyperlink" href="https://stock.hostmonit.com/CloudFlareYes" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>CloudFlare公共优选教程1：</span><a class="hyperlink" href="https://www.youtube.com/watch?v=uCgRb7KfANo" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>CloudFlare公共优选教程2：</span><a class="hyperlink" href="https://www.youtube.com/watch?v=oTwnwZEJpWo&amp;feature=youtu.be" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>CDN优选域名和IP教程：</span><a class="hyperlink" href="https://www.freedidi.com/10143.html" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><a class="hyperlink" href="https://www.itdog.cn/tcping/" hreftitle="在线TCP延迟测试" sync2href="false" target="_Blank"><strong><span style="font-weight:bold;">在线TCP延迟测试</span></strong></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>域名价格表：</span><a class="hyperlink" href="https://www.baota.me/post-410.html" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div></div></div></div>
  | 节点优选流程如下
-- | --
步骤 | 主域名A | 加速域名B
第一步： | 在CF的ZeroTrust的Tunnels中，把A,B都映射到alist网站上(alist.A和alist.B)
第二步： |   | 1.回退源设置成【alist.B】2.自定义主机设置成【alist.A】
第三步： | 第二步的2中会生成一些DNS解析，添加到A的DNS中(#1) | 设置一个优选节点到【fast.B】
第四步： | 把【alist.A】指向到【fast.B】,关闭CF的代理 |  
温馨提示： |   |  

<h3 backgroundcolor="0" class="otl-heading" level="3" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>#1关于回退源中自定义主机的DNS认证的解决办法</span></h3><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #E6FAEB;border-color: #AFE3BB;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><strong><span style="font-weight:bold;">解决灵感的帖子：</span></strong><a class="hyperlink" href="https://blog.tsinbei.com/archives/1267/" hreftitle="点我" sync2href="false" target="_Blank"><strong><span style="font-weight:bold;">点我</span></strong></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>如果回退源中--&gt;自定义主机验证--&gt;主机名的状态(</span><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">验证失败</span></strong></span><span>)</span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>请：假设</span><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">回退域名</span></strong></span><span>（</span><a class="hyperlink" href="https://callback.tsinbei.com/" hreftitle="callback.tsinbei.com" sync2href="true" target="_Blank"><span>callback.tsinbei.com</span></a><span>）</span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>       </span><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">自定义主机域名</span></strong></span><span>（</span><a class="hyperlink" href="https://custom.tsinbei.com/" hreftitle="custom.tsinbei.com" sync2href="true" target="_Blank"><span>custom.tsinbei.com</span></a><span>）(</span><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">验证失败</span></strong></span><span>)</span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>      那么</span><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">自定义主机域名</span></strong></span><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">中设置一个CNAME</span></strong></span><span> ：</span><code style="font-size:16px;"><span class="color_font" style="color:#0E52D4;"><span style="color:#0E52D4;">csutome</span></span></code><span>指向</span><a class="hyperlink" href="https://callback.tsinbei.com/" sync2href="true" target="_Blank"><code style="background-color:rgb(255, 255, 255);font-size:16px;"><span>callback.tsinbei.com</span></code></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>温馨提示：</span><span class="color_font" style="background-color:#C6EADD;color:#C21C13;mso-highlight:#C6EADD;text-decoration:underline;"><u><span style="background-color:#C6EADD;color:#C21C13;mso-highlight:#C6EADD;text-decoration:underline;">无论使用何种方法验证，验证成功后均可以删除验证记录（TXT 或 CNAME）并进行自选。经测试，同一个主机名验证成功一次后就不会再次验证。</span></u></span></p></div></div></div></div><h3 backgroundcolor="0" class="otl-heading" level="3" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>#2网页版SSH做CDN加速时候遇到的问题</span></h3><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #E6FAEB;border-color: #AFE3BB;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>在</span><strong><span style="font-weight:bold;">加速域名B</span></strong><span>的</span><strong><span style="font-weight:bold;">回退源</span></strong><span>设置了自定义主机</span><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">ssh.A</span></strong></span></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">主域名ssh.A</span></strong></span><strong><span style="font-weight:bold;">这里的cname</span></strong><span class="color_font" style="background-color:#FBF5B3;color:#C21C13;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;color:#C21C13;font-weight:bold;mso-highlight:#FBF5B3;">不是</span></strong></span><strong><span style="font-weight:bold;">指向</span></strong><span class="color_font" style="background-color:#FBF5B3;color:#C21C13;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;color:#C21C13;font-weight:bold;mso-highlight:#FBF5B3;">fast.B</span></strong></span></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">主域名ssh.A</span></strong></span><strong><span style="font-weight:bold;">保持隧道</span></strong><strong><span style="font-size:13px;font-weight:bold;">Tunnels</span></strong><strong><span style="font-weight:bold;">自动生成的配置(ssh.A)，并且小黄云CF代理要开着,否则ssh.A无法访问</span></strong></li></ol></div><div class="sub-doc-tile" config="{}" info="{}"><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;font-weight:bold;text-decoration:underline;"><strong><u><span style="color:#C21C13;font-weight:bold;text-decoration:underline;">并且ssh.A也要去做一个application</span></u></strong></span></li></ol></div></div></div></div><h3 backgroundcolor="0" class="otl-heading" level="3" listlevel="0" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>#3自定义主机证书的自动续订的问题</span></h3><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #E6FAEB;border-color: #AFE3BB;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>自定义主机(主域名)</span><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">ssh.A下面</span></strong></span><span class="color_font" style="color:#C21C13;font-weight:bold;text-decoration:underline;"><strong><u><span style="color:#C21C13;font-weight:bold;text-decoration:underline;">加一个CNAME</span></u></strong></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><h3 backgroundcolor="0" class="otl-heading" level="3" listlevel="0" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span class="color_font" style="font-weight:bold;"><strong><span style="font-weight:bold;">自定义主机名的 DCV 委派</span></strong></span></h3></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>_</span><code style="font-size:16px;"><span>acme-challenge.&lt;hostname&gt;</span></code><span> </span><code style="font-size:16px;"><span>&lt;hostname&gt;.</span></code><code style="font-size:16px;"><span disabledlink="true"><span>6ec077ddb0899695.dcv.cloudflare.com</span></span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>CNAME的Key里面只需要写sub域名</span><span class="color_font" style="color:#C21C13;font-size:20px;font-weight:bold;"><strong><span style="color:#C21C13;font-size:20px;font-weight:bold;">ssh</span></strong></span><span>，</span><span class="color_font" style="color:#C21C13;text-decoration:underline;"><u><span style="color:#C21C13;text-decoration:underline;">cloudflare会自动补充完整域名的</span></u></span><span>，但是value里面要写</span><span class="color_font" style="color:#C21C13;font-size:20px;font-weight:bold;"><strong><span style="color:#C21C13;font-size:20px;font-weight:bold;">ssh.A</span></strong></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>_</span><code style="font-size:16px;"><span>acme-challenge</span></code><code style="font-size:16px;"><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">.ssh</span></strong></span></code><span> </span><code style="font-size:16px;"><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">ssh.A.</span></strong></span></code><code style="font-size:16px;"><span>&lt;hostname&gt;.</span></code><code style="font-size:16px;"><span disabledlink="true"><span>6ec077ddb0899695.dcv.cloudflare.com</span></span></code></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;text-decoration:underline;"><u><span style="color:#C21C13;text-decoration:underline;">温馨提示：实际内容请参考“</span></u></span><span class="color_font" style="color:#C21C13;font-weight:bold;text-decoration:underline;"><strong><u><span style="color:#C21C13;font-weight:bold;text-decoration:underline;">自定义主机名的 DCV 委派</span></u></strong></span><span class="color_font" style="color:#C21C13;text-decoration:underline;"><u><span style="color:#C21C13;text-decoration:underline;">”</span></u></span></p></div></div></div></div><h3 backgroundcolor="0" class="otl-heading" level="3" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>CF加速成功验证</span></h3><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #E6FAEB;border-color: #AFE3BB;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><a class="hyperlink" href="https://www.itdog.cn/http/" hreftitle="在线网站测试" sync2href="false" target="_Blank"><strong><span style="font-weight:bold;">在线网站测试</span></strong></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p style="height:auto;overflow:hidden;text-align:left;"><img align="left" bordertype="0" fileid="387283028536" imgid="ZVpOjH7vGDn0ZiZG" oriheight="464" oriwidth="1625" rotate="0" sourcekey="XEX5E2A7ABQFE" src="http://www.kdocs.cn/api/v3/office/copy/ekg3MHNIQkZ3TzVuaUR0eUJ4SmZZNlB1Rlo2MEFNaWdFNVFPTGNXbHp3SHZDWjJVZzFpTkN5Y1NpZXd3S1RWVVZtcjdPUnRUK2tSVUVQK3JSNFB1N1NSQUs5UE56WFNzUXEvWkdER1BWeFJhTXljbjVOWDNJTHVjUWZHdjRiaFpjSVdkS2hoenlRUm1QTWk4ZzF0WE80Ujl1Q3JmdUdBY05QWGN4emNTNGRtbWhGdkQ1ZlJrZjJCd2tmMHF0STFBZFFST3o0aFEyWE1ld3VVMHVWN0tERU5Ob1VuT3RLWlJ5V0luWDJGaFoveElZT0dYNEUycjJOeTFkWTBJTUZFQWdCV24vOUVUQk9zPQ==/attach/object/XEX5E2A7ABQFE?" storageversion="1" userid="1545611636" width="1625" zoom="1"></p></div><div class="sub-doc-tile" config="{}" info="{}"><p style="height:auto;overflow:hidden;text-align:left;"><img align="left" bordertype="0" fileid="387283028536" imgid="kgSqbopQZqrfxl8n" oriheight="575" oriwidth="1582" rotate="0" sourcekey="2ZQ5G2A7AAAAE" src="http://www.kdocs.cn/api/v3/office/copy/ekg3MHNIQkZ3TzVuaUR0eUJ4SmZZNlB1Rlo2MEFNaWdFNVFPTGNXbHp3SHZDWjJVZzFpTkN5Y1NpZXd3S1RWVVZtcjdPUnRUK2tSVUVQK3JSNFB1N1NSQUs5UE56WFNzUXEvWkdER1BWeFJhTXljbjVOWDNJTHVjUWZHdjRiaFpjSVdkS2hoenlRUm1QTWk4ZzF0WE80Ujl1Q3JmdUdBY05QWGN4emNTNGRtbWhGdkQ1ZlJrZjJCd2tmMHF0STFBZFFST3o0aFEyWE1ld3VVMHVWN0tERU5Ob1VuT3RLWlJ5V0luWDJGaFoveElZT0dYNEUycjJOeTFkWTBJTUZFQWdCV24vOUVUQk9zPQ==/attach/object/2ZQ5G2A7AAAAE?" storageversion="1" userid="1545611636" width="1582" zoom="1"></p></div></div></div></div><h2 backgroundcolor="0" class="otl-heading" level="2" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>踩到的坑</span></h2><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #FAF1E6;border-color: #FEC794;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><p style="height:auto;overflow:hidden;text-align:left;"><img align="left" bordertype="0" fileid="387283028536" imgid="VcdrO63uxhMANUGs" oriheight="442" oriwidth="1535" rotate="0" sourcekey="37FR4WA7AAQBG" src="http://www.kdocs.cn/api/v3/office/copy/ekg3MHNIQkZ3TzVuaUR0eUJ4SmZZNlB1Rlo2MEFNaWdFNVFPTGNXbHp3SHZDWjJVZzFpTkN5Y1NpZXd3S1RWVVZtcjdPUnRUK2tSVUVQK3JSNFB1N1NSQUs5UE56WFNzUXEvWkdER1BWeFJhTXljbjVOWDNJTHVjUWZHdjRiaFpjSVdkS2hoenlRUm1QTWk4ZzF0WE80Ujl1Q3JmdUdBY05QWGN4emNTNGRtbWhGdkQ1ZlJrZjJCd2tmMHF0STFBZFFST3o0aFEyWE1ld3VVMHVWN0tERU5Ob1VuT3RLWlJ5V0luWDJGaFoveElZT0dYNEUycjJOeTFkWTBJTUZFQWdCV24vOUVUQk9zPQ==/attach/object/37FR4WA7AAQBG?" storageversion="1" userid="1545611636" width="1535" zoom="1"></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>在</span><strong><span style="font-size:18px;font-weight:bold;">cloudflare中配置公共主机名</span></strong><span>的时候，一定</span><span class="color_font" style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;"><strong><span style="background-color:#FBF5B3;font-weight:bold;mso-highlight:#FBF5B3;">不要设置路径</span></strong></span><span>，</span><span class="color_font" style="color:#C21C13;font-size:18px;font-weight:bold;text-decoration:underline;"><strong><u><span style="color:#C21C13;font-size:18px;font-weight:bold;text-decoration:underline;">否则可能会造成js,css无法正常返回</span></u></strong></span></p></div></div></div></div><h2 backgroundcolor="0" class="otl-heading" level="2" listlevel="0" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span>关于内网穿透的一些补充内容</span></h2><div class="sub-doc" extraattrs="{}" type="HighlightBlock"><div class="sub-doc-object" nodename="HighlightBlock" style="background-color: #FAF1E6;border-color: #FEC794;"><div class="sub-doc-layout-object" classname="left-content-box"><div class="sub-doc-tile" config="{}" info="{}"><div canbedelete="true" class="readonly-inline-container" nodename="HighlightBlock" static="true" traversable="true"><span class="otl-emoji" emoji="⭐" emoji_name="Star" emoji_type="base" unicode="U+2B50">⭐</span></div></div></div><div class="sub-doc-layout-object" classname="right-content-box"><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>用</span><span class="color_font" style="color:#C21C13;font-size:20px;font-weight:bold;"><strong><span style="color:#C21C13;font-size:20px;font-weight:bold;">cpolar</span></strong></span><span>也可以做</span><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">内网穿透</span></strong></span><span class="color_font" style="color:#080F17;text-decoration:underline;"><u><span style="color:#080F17;text-decoration:underline;">（不过没有试验过，教程如下）</span></u></span></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span>图文教程：</span><a class="hyperlink" href="https://developer.aliyun.com/article/1487189?spm=5176.26934562.main.1.763bb724frQ2gg" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span>油管视频：</span><a class="hyperlink" href="https://www.youtube.com/watch?v=nMsyAUfPshE&amp;t=246s" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span>官方教程：</span><a class="hyperlink" href="https://www.cpolar.com/blog/cpolar-quick-start-tutorial-ubuntu-series" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div><div class="sub-doc-tile" config="{}" info="{}"><p backgroundcolor="0" class="otl-paragraph" listlevel="0" style="text-align:left;" textalign="left"><span>docker版安装：</span><a class="hyperlink" href="https://www.cpolar.com/blog/docker-container-installation-cpolar" hreftitle="点我" sync2href="false" target="_Blank"><span>点我</span></a></p></div></div></div></div><h4 backgroundcolor="0" class="otl-heading" level="4" style="text-indent:0em;padding-left:0em;text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;font-weight:bold;"><strong><span style="color:#C21C13;font-weight:bold;">cpolar的部署（Alpine服务器）</span></strong></span></h4><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>查看AlpineLinux架构</span></li></ol><pre><code autowrap="false" lang="bash" theme="dark"><span>lscpu</span></code></pre><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>下载cpolar并解压</span></li></ol><blockquote backgroundcolor="3" style="padding-left:1em;text-indent:0em;text-align:left;background-color: #FFECEB; border-radius: 3px; 
      box-shadow: -2px -2px #FFECEB, 2px 2px #FFECEB, 2px -2px #FFECEB, -2px 2px #FFECEB;
      --current-bg-color: #FFECEB;" textalign="left"><span>当前使用版本：</span><a class="link-title-view" description="文件大小：7.1 M" href="https://wwvj.lanzoum.com/iHbEy2tefv7e" hreftitle="cpolar-stable-linux-amd64.zip - 蓝奏云" sourcekey="GB4RK3Q7ABQEC" storageversion="1" style="font-size:13px;" url="https://wwvj.lanzoum.com/iHbEy2tefv7e" viewtype="titleView">https://wwvj.lanzoum.com/iHbEy2tefv7e</a></blockquote><pre><code autowrap="false" lang="bash" theme="dark"><span>curl -L https://www.cpolar.com/static/downloads/releases/3.3.12/cpolar-stable-linux-amd64.zip -o cpolar-stable-linux-amd64.zip
unzip cpolar-stable-linux-amd64.zip 
mv cpolar /usr/local/bin/</span></code></pre><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>制作alpine服务（service）文件（cpolar的配置文件yml）</span></li></ol><blockquote backgroundcolor="0" style="padding-left:1em;text-indent:0em;text-align:left;" textalign="left"><span>mkdir -p /etc/cpolar</span><br style="mso-data-placement:same-cell;"><span>vi /etc/cpolar/cpolar.yml</span></blockquote><pre><code autowrap="false" lang="bash" theme="dark"><span># vi: set shiftwidth=2 tabstop=2 softtabstop=2 ai expandtab:
authtoken: your_auth_token
tunnels:
  website:
    addr: 8080
    proto: http
  ssh:
    proto: tcp
    addr: 22</span></code></pre><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>制作alpine服务（service）文件（脚本）</span></li></ol><blockquote backgroundcolor="0" style="padding-left:1em;text-indent:0em;text-align:left;" textalign="left"><span>touch /etc/init.d/cpolar</span><br style="mso-data-placement:same-cell;"><span>vi /etc/init.d/cpolar</span></blockquote><pre><code autowrap="false" lang="bash" theme="dark"><span>#!/sbin/openrc-run

name="cpolar"
command="/usr/local/bin/cpolar"
command_args="--config /etc/cpolar/cpolar.yml -log /var/log/cpolar/access.log"
pidfile="/run/cpolar.pid"
depend() {
    need net
    before docker
}
start() {
    ebegin "Starting cpolar"
    start-stop-daemon --start --background --pidfile $pidfile --exec $command -- $command_args
    eend $?
}
stop() {
    ebegin "Stopping cpolar"
    start-stop-daemon --stop --pidfile $pidfile
    eend $?
}
</span></code></pre><blockquote backgroundcolor="3" style="padding-left:1em;text-indent:0em;text-align:left;background-color: #FFECEB; border-radius: 3px; 
      box-shadow: -2px -2px #FFECEB, 2px 2px #FFECEB, 2px -2px #FFECEB, -2px 2px #FFECEB;
      --current-bg-color: #FFECEB;" textalign="left"><span>chmod +x /etc/init.d/cpolar</span></blockquote><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>使用cpolar服务</span></li></ol><pre><code autowrap="false" lang="bash" theme="dark"><span>rc-update add cpolar default

rc-service cpolar status
#可使用选项
#  -start
#  -restart
#  -stop
#  -status</span></code></pre><ol><li backgroundcolor="0" class="otl-paragraph" listformat="{0}." listlevel="0" listtype="ordered" listvalue="aribicNum" style="padding-left:1.4em;text-indent:-1.4em;text-align:left;" textalign="left"><span>开启cpolar隧道</span></li></ol><pre><code autowrap="false" lang="bash" theme="dark"><span>cpolar authtoken xxxxxxx</span></code></pre><blockquote backgroundcolor="3" style="padding-left:1em;text-indent:0em;text-align:left;background-color: #FFECEB; border-radius: 3px; 
      box-shadow: -2px -2px #FFECEB, 2px 2px #FFECEB, 2px -2px #FFECEB, -2px 2px #FFECEB;
      --current-bg-color: #FFECEB;" textalign="left"><span>检证命令：</span><br style="mso-data-placement:same-cell;"><code style="font-size:16px;"><span>cpolar http 8080</span></code></blockquote><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"><span class="color_font" style="color:#C21C13;font-size:22px;font-weight:bold;"><strong><span style="color:#C21C13;font-size:22px;font-weight:bold;">实验完毕，垃圾别用！！！</span></strong></span></p><p style="height:auto;overflow:hidden;text-align:left;"><img align="left" bordertype="0" fileid="387283028536" imgid="L5noSegAhbAY9sYO" oriheight="303" oriwidth="1698" rotate="0" sourcekey="7CEEE3Q7AAAFU" src="http://www.kdocs.cn/api/v3/office/copy/ekg3MHNIQkZ3TzVuaUR0eUJ4SmZZNlB1Rlo2MEFNaWdFNVFPTGNXbHp3SHZDWjJVZzFpTkN5Y1NpZXd3S1RWVVZtcjdPUnRUK2tSVUVQK3JSNFB1N1NSQUs5UE56WFNzUXEvWkdER1BWeFJhTXljbjVOWDNJTHVjUWZHdjRiaFpjSVdkS2hoenlRUm1QTWk4ZzF0WE80Ujl1Q3JmdUdBY05QWGN4emNTNGRtbWhGdkQ1ZlJrZjJCd2tmMHF0STFBZFFST3o0aFEyWE1ld3VVMHVWN0tERU5Ob1VuT3RLWlJ5V0luWDJGaFoveElZT0dYNEUycjJOeTFkWTBJTUZFQWdCV24vOUVUQk9zPQ==/attach/object/7CEEE3Q7AAAFU?" storageversion="1" userid="1545611636" width="1698" zoom="1"></p><p backgroundcolor="0" class="otl-paragraph" style="text-align:left;" textalign="left"></p></div></div></body></html><!--EndFragment-->
</body>
</html>第二章：cloudflare做网络穿透
⭐1. 下载cloudflare的安装包
curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64 -o /usr/local/bin/cloudflared
2. 赋予执行权限
chmod +x /usr/local/bin/cloudflared
3. 确认是否安装成功
cloudflared version
4. 执行
cloudflared service install 你的密钥

卸载命令：cloudflared service uninstall
Docker版看这里
参考这个链接：[点我](https://sspai.com/post/79278)
docker的附加参数：
• --link alist:alist #容器间相互通信
• --network host #容器内的应用就能直接访问宿主机的 localhost
docker run --link alist:alist cloudflare/cloudflared:latest tunnel --no-autoupdate run --token 你的token
已废弃部分
⭐1. 下载cloudflare的ubuntu文件
curl -L --output cloudflared.deb https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
注意：这里curl可能会碰到https无法下载的问题，建议把文件放到http（AList）下面
2. sudo dpkg -i cloudflared.deb 
注意：这里可能会报错package architecture (amd64) does not match system (arm64)
解决：sudo dpkg -i --force-architecture cloudflared.deb （[点击参考](https://github.com/kubernetes/minikube/issues/10001)）
3. sudo cloudflared service install 你的密钥
成功会显示：Illegal instruction
网页版SSH内网穿透
⭐1. 将服务器连接到 Cloudflare：
    ◦ 创建 Cloudflare Tunnel： 登录到 Cloudflare Zero Trust 仪表板，导航至“Networks” > “Tunnels”，点击“Create a tunnel”。选择“Cloudflared”作为连接器类型，输入隧道名称，然后点击“Save tunnel”。
    ◦ 安装并运行 cloudflared： 根据您的服务器操作系统，下载并安装 cloudflared。在服务器上运行提供的命令以启动 cloudflared，这将建立服务器与 Cloudflare 之间的隧道连接。
    ◦ 配置公共主机名： 在隧道的“Public Hostnames”选项卡中，选择一个域名和子域名（例如 [ssh.example.com](https://ssh.example.com/)），将其指向您的 SSH 服务（通常是 localhost:22）。保存主机名设置。 
2. 配置 Cloudflare Access 应用程序：(下面的步骤一定要做！)
    ◦ 创建应用程序： 在 Cloudflare Zero Trust 仪表板中，转到“Access” > “Applications”，点击“Add an application”，选择“Self-hosted”。
    ◦ 设置应用程序详细信息： 输入应用程序名称，设置“Application domain”为之前配置的公共主机名（例如 [ssh.example.com](https://ssh.example.com/)）。
    ◦ 配置访问策略： 在“Policies”选项卡中，添加相应的访问策略，指定允许访问该应用程序的用户或组。(必须配置一个Everyone的mail策略，否则无法收到邮件)
    ◦ 启用浏览器渲染： 在“Advanced settings”下的“Browser rendering settings”中，将“Browser rendering”设置为“SSH”。保存应用程序设置。 
3. 用户访问 SSH 终端：
    ◦ 访问公共主机名： 用户在浏览器中访问配置的公共主机名（例如 https://ssh.example.com/）。
    ◦ 身份验证： 用户将根据之前配置的访问策略进行身份验证。
    ◦ Linux账户验证：输入alpine，密码alpine
    ◦ 使用浏览器终端： 成功验证后，Cloudflare 将在浏览器中呈现一个 SSH 终端，用户可以直接在其中操作服务器，无需在客户端安装任何额外的软件或管理 SSH 密钥。 
CF节点优选
⭐CloudFlare公共优选Cname域名地址1：[点我](https://www.wetest.vip/)
CloudFlare公共优选Cname域名地址2：[点](https://www.wetest.vip/)[我](https://blog.nbvil.com/nat/saasip/)
CloudFlare优质IP：[点我](https://stock.hostmonit.com/CloudFlareYes)
CloudFlare公共优选教程1：[点我](https://www.youtube.com/watch?v=uCgRb7KfANo)
CloudFlare公共优选教程2：[点我](https://www.youtube.com/watch?v=oTwnwZEJpWo&feature=youtu.be)
CDN优选域名和IP教程：[点我](https://www.freedidi.com/10143.html)
[在线TCP延迟测试](https://www.itdog.cn/tcping/)

域名价格表：[点我](https://www.baota.me/post-410.html)

节点优选流程如下

步骤
主域名A
加速域名B

第一步：
在CF的ZeroTrust的Tunnels中，把A,B都映射到alist网站上(alist.A和alist.B)

第二步：

1.回退源设置成【alist.B】
2.自定义主机设置成【alist.A】

第三步：
第二步的2中会生成一些DNS解析，添加到A的DNS中([#1](https://kdocs.cn/l/cheRD9wHnLXd?linkname=o71OFSy27a))
设置一个优选节点到【fast.B】

第四步：
把【alist.A】指向到【fast.B】,关闭CF的代理


温馨提示：



#1关于回退源中自定义主机的DNS认证的解决办法
⭐解决灵感的帖子：[点我](https://blog.tsinbei.com/archives/1267/)
如果回退源中-->自定义主机验证-->主机名的状态(验证失败)
请：假设回退域名（[callback.tsinbei.com](https://callback.tsinbei.com/)）
       自定义主机域名（[custom.tsinbei.com](https://custom.tsinbei.com/)）(验证失败)
      那么自定义主机域名中设置一个CNAME ：csutome指向[callback.tsinbei.com](https://callback.tsinbei.com/)
温馨提示：无论使用何种方法验证，验证成功后均可以删除验证记录（TXT 或 CNAME）并进行自选。经测试，同一个主机名验证成功一次后就不会再次验证。
#2网页版SSH做CDN加速时候遇到的问题
⭐1. 在加速域名B的回退源设置了自定义主机ssh.A
2. 主域名ssh.A这里的cname不是指向fast.B
3. 主域名ssh.A保持隧道Tunnels自动生成的配置(ssh.A)，并且小黄云CF代理要开着,否则ssh.A无法访问
4. 并且ssh.A也要去做一个application
#3自定义主机证书的自动续订的问题
⭐自定义主机(主域名)ssh.A下面加一个CNAME
自定义主机名的 DCV 委派
_acme-challenge.<hostname> <hostname>.6ec077ddb0899695.dcv.cloudflare.com
CNAME的Key里面只需要写sub域名ssh，cloudflare会自动补充完整域名的，但是value里面要写ssh.A
_acme-challenge.ssh ssh.A.<hostname>.6ec077ddb0899695.dcv.cloudflare.com
温馨提示：实际内容请参考“自定义主机名的 DCV 委派”
CF加速成功验证
⭐[在线网站测试](https://www.itdog.cn/http/)
踩到的坑
⭐在cloudflare中配置公共主机名的时候，一定不要设置路径，否则可能会造成js,css无法正常返回
关于内网穿透的一些补充内容
⭐用cpolar也可以做内网穿透（不过没有试验过，教程如下）
图文教程：[点我](https://developer.aliyun.com/article/1487189?spm=5176.26934562.main.1.763bb724frQ2gg)
油管视频：[点我](https://www.youtube.com/watch?v=nMsyAUfPshE&t=246s)
官方教程：[点我](https://www.cpolar.com/blog/cpolar-quick-start-tutorial-ubuntu-series)
docker版安装：[点我](https://www.cpolar.com/blog/docker-container-installation-cpolar)
cpolar的部署（Alpine服务器）
1. 查看AlpineLinux架构
lscpu2. 下载cpolar并解压
当前使用版本：https://wwvj.lanzoum.com/iHbEy2tefv7e
curl -L https://www.cpolar.com/static/downloads/releases/3.3.12/cpolar-stable-linux-amd64.zip -o cpolar-stable-linux-amd64.zip
unzip cpolar-stable-linux-amd64.zip 
mv cpolar /usr/local/bin/3. 制作alpine服务（service）文件（cpolar的配置文件yml）
mkdir -p /etc/cpolar
vi /etc/cpolar/cpolar.yml
# vi: set shiftwidth=2 tabstop=2 softtabstop=2 ai expandtab:
authtoken: your_auth_token
tunnels:
  website:
    addr: 8080
    proto: http
  ssh:
    proto: tcp
    addr: 224. 制作alpine服务（service）文件（脚本）
touch /etc/init.d/cpolar
vi /etc/init.d/cpolar
#!/sbin/openrc-run

name="cpolar"
command="/usr/local/bin/cpolar"
command_args="--config /etc/cpolar/cpolar.yml -log /var/log/cpolar/access.log"
pidfile="/run/cpolar.pid"
depend() {
    need net
    before docker
}
start() {
    ebegin "Starting cpolar"
    start-stop-daemon --start --background --pidfile $pidfile --exec $command -- $command_args
    eend $?
}
stop() {
    ebegin "Stopping cpolar"
    start-stop-daemon --stop --pidfile $pidfile
    eend $?
}
chmod +x /etc/init.d/cpolar
5. 使用cpolar服务
rc-update add cpolar default

rc-service cpolar status
#可使用选项
#  -start
#  -restart
#  -stop
#  -status6. 开启cpolar隧道
cpolar authtoken xxxxxxx检证命令：
cpolar http 8080
实验完毕，垃圾别用！！！